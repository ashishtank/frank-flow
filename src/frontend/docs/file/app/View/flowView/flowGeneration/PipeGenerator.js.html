<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../../">
  <title data-ice="title">app/View/flowView/flowGeneration/PipeGenerator.js | Frank!Flow</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="dev tool to work with the Frank framework"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Frank!Flow"><meta property="twitter:description" content="dev tool to work with the Frank framework"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#controller">Controller</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Controller/CodeController.js~CodeController.html">CodeController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Controller/FlowController.js~FlowController.html">FlowController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Controller/PipeInfoController.js~PipeInfoController.html">PipeInfoController</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#converter">Converter</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Converter/ConfigurationConverter.js~ConfigurationConverter.html">ConfigurationConverter</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#facade">Facade</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Facade/CodeFacade.js~CodeFacade.html">CodeFacade</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#model">Model</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Model/FileModel.js~FileModel.html">FileModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Model/FlowModel.js~FlowModel.html">FlowModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Model/IbisdocModel.js~IbisdocModel.html">IbisdocModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Model/PipeModel.js~PipeModel.html">PipeModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Model/XsdModel.js~XsdModel.html">XsdModel</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-codeview">View/codeView</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/CodeView.js~CodeView.html">CodeView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/FileTreeView.js~FileTreeView.html">FileTreeView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/ToBeautifulSyntax.js~ToBeautifulSyntax.html">ToBeautifulSyntax</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/ValidateConfigurationView.js~ValidateConfigurationView.html">ValidateConfigurationView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-logColor">logColor</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-codeview-codecompletion">View/codeView/codeCompletion</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeCompletion/XSDCodeCompletionView.js~XSDCodeCompletionView.html">XSDCodeCompletionView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-codeview-codeeditviews">View/codeView/codeEditViews</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/CodeAttributesView.js~CodeAttributesView.html">CodeAttributesView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/CodeEditView.js~CodeEditView.html">CodeEditView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/CodeParametersView.js~CodeParametersView.html">CodeParametersView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/CodePipeView.js~CodePipeView.html">CodePipeView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/CodeTypesView.js~CodeTypesView.html">CodeTypesView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/ExitPipeView.js~ExitPipeView.html">ExitPipeView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/OptionView.js~OptionView.html">OptionView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-flowview">View/flowView</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/DescriptionView.js~DescriptionView.html">DescriptionView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/FlowView.js~FlowView.html">FlowView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/TypeImageView.js~TypeImageView.html">TypeImageView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-flowview-flowgeneration">View/flowView/flowGeneration</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/flowGeneration/CustomElementGenerator.js~CustomElementGenerator.html">CustomElementGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/flowGeneration/FlowGenerator.js~FlowGenerator.html">FlowGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/flowGeneration/ForwardGenerator.js~ForwardGenerator.html">ForwardGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/flowGeneration/PipeGenerator.js~PipeGenerator.html">PipeGenerator</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-flowview-pipe">View/flowView/pipe</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/pipe/ActivityPipeView.js~ActivityPipeView.html">ActivityPipeView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/pipe/PipeBuilder.js~PipeBuilder.html">PipeBuilder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/pipe/PipeView.js~PipeView.html">PipeView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-paletteview">View/paletteView</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/paletteView/PaletteView.js~PaletteView.html">PaletteView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-pipeinfoview">View/pipeInfoView</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/pipeInfoView/PipeInfoView.js~PipeInfoView.html">PipeInfoView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-pipeinfoview-specialpipes">View/pipeInfoView/SpecialPipes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/pipeInfoView/SpecialPipes/XsltInfoView.js~XsltInfoView.html">XsltInfoView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-pipeinfoview-attributes">View/pipeInfoView/attributes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/pipeInfoView/attributes/GenerateInfoAttributesView.js~GenerateInfoAttributesView.html">GenerateInfoAttributesView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-pipeinfoview-parameters">View/pipeInfoView/parameters</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/pipeInfoView/parameters/GenerateInfoParametersView.js~GenerateInfoParametersView.html">GenerateInfoParametersView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#services">services</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/FileService.js~FileService.html">FileService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/IbisdocService.js~IbisdocService.html">IbisdocService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/PipeService.js~PipeService.html">PipeService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/XsdService.js~XsdService.html">XsdService</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">app/View/flowView/flowGeneration/PipeGenerator.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import PipeView from &apos;../pipe/PipeView.js&apos;;
import PipeBuilder from &apos;../pipe/PipeBuilder.js&apos;
import ForwardGenerator from &apos;./ForwardGenerator.js&apos;;
import CustomElementGenerator from &apos;./CustomElementGenerator.js&apos;;

export default class PipeGenerator {

    constructor(flowModel, flowView) {
        this.flowModel = flowModel;
        this.flowView = flowView;
        this.forwardGenerator = new ForwardGenerator(flowModel, flowView);
        this.pipeDict = {};
        this.customElementGenerator = new CustomElementGenerator(flowView, this.pipeDict);
    }

    generateAllPipes(transformedXml) {
        if (transformedXml.Adapter.Pipeline.pipe != null) {
            $(&apos;#canvas&apos;).text(&quot;Adapter: &quot; + transformedXml.Adapter[&apos;@name&apos;] + &apos; &apos;);
            let pipe = transformedXml.Adapter.Pipeline.pipe;
            let forwards = [];
            let possitions = &quot;&quot;;

            if (Array.isArray(pipe)) {
                possitions = this.generateMultiplePipes(pipe, forwards, possitions);
            } else {
                this.generateSinglePipe(pipe, forwards);
            }
            this.customElementGenerator.addExits(transformedXml.Adapter.Pipeline.Exit);

            if (possitions == &quot;duplicate&quot;) {
                this.flowView.displayError(&quot;dupplicate&quot;);
                return;
            }
            else if (possitions == null) {
                this.flowView.realignFlow();
            }
            if (transformedXml.Adapter.Receiver != null) {
                let receiver = transformedXml.Adapter.Receiver;
                if(Array.isArray(receiver)) {
                    let cur = this;
                    receiver.forEach(function(item, index) {
                        forwards.push(cur.customElementGenerator.addReceiver(item, forwards[0].sourcePipe))
                    })
                } else {
                    forwards.push(this.customElementGenerator.addReceiver(receiver, forwards[0].sourcePipe));
                }
            }

            this.forwardGenerator.generateForwards(forwards);
        }
        return this.pipeDict;
    }

    generateMultiplePipes(pipe, forwards, possitions) {
        let cur = this,
            error = false;
        let sortedPipe = pipe.slice().sort();
        sortedPipe.forEach((currentPipe, index) =&gt; {
            if (sortedPipe[index + 1] != null) {
                if (sortedPipe[index + 1][&apos;@name&apos;] === currentPipe[&apos;@name&apos;]) {
                    console.log(&apos;duplicate: &apos;, currentPipe);
                    error = true;
                }
            }
        })


        if (error) {
            return &quot;duplicate&quot;;
        }

        for (let p in pipe) {
            let name = pipe[p][&apos;@name&apos;],
                xpos = pipe[p][&apos;@x&apos;],
                ypos = pipe[p][&apos;@y&apos;],
                extraText = &quot;&quot;,
                docText = null;

            possitions = this.checkPossitions(xpos, ypos);

            extraText = this.createExtraText(pipe, p);
            docText = this.createDocText(pipe, p);


            this.pipeDict[name] = new PipeBuilder(this.flowView, name)
                .withPositions(possitions)
                .withExtra(extraText)
                .withDescText(docText)
                .build()
                .pipeModel;

            if (pipe[p].Forward != null) {
                forwards = this.createPipeForward(pipe, name, p, forwards);
            } else {
                forwards = this.createDefaultForward(pipe, name, p, forwards);
            }
        }
        return possitions;
    }

    createDefaultForward(pipe, name, p, forwards) {
        let nextPipe = parseInt(p) + 1;
        if (pipe[nextPipe] != null) {
            let forwardData = {
                sourcePipe: name,
                targetPipe: pipe[nextPipe][&apos;@name&apos;],
                name: &quot;success&quot;
            }
            forwards.push(forwardData);
        }

        return forwards;
    }

    createPipeForward(pipe, name, p, forwards) {
        let forwardData = null;

        if (Array.isArray(pipe[p].Forward)) {
            pipe[p].Forward.forEach(function (item, index) {
                forwardData = {
                    sourcePipe: name,
                    targetPipe: item[&apos;@path&apos;],
                    name: item[&apos;@name&apos;]
                };
                forwards.push(forwardData);
            });
        } else {
            forwardData = {
                sourcePipe: name,
                targetPipe: pipe[p].Forward[&apos;@path&apos;],
                name: pipe[p].Forward[&apos;@name&apos;]
            };
            forwards.push(forwardData);
        }

        return forwards;
    }

    createExtraText(pipe, p) {
        let extraText = &quot;&quot;;
        if (pipe[p][&apos;@xpathExpression&apos;] != null) {
            extraText = pipe[p][&apos;@xpathExpression&apos;].slice(0, 15) + &apos;...&apos;;
        } else if (pipe[p].FixedQuerySender != null &amp;&amp; pipe[p].FixedQuerySender[&apos;@query&apos;] != null) {
            extraText = pipe[p].FixedQuerySender[&apos;@query&apos;].slice(0, 15) + &apos;...&apos;;
        }

        return extraText;
    }

    createDocText(pipe, p) {
        let docText = null;

        if (pipe[p].Documentation != null) {
            console.log(pipe[p].Documentation);
            docText = pipe[p].Documentation;
        }

        return docText;
    }

    generateSinglePipe(pipe, forwards) {
        let name = pipe[&apos;@name&apos;],
        xpos = pipe[&apos;@x&apos;],
        ypos = pipe[&apos;@y&apos;];

        let possitions = this.checkPossitions(xpos, ypos);

        this.pipeDict[name] = new PipeBuilder(this.flowView, name)
        .withPositions(possitions)
        .build()
        .pipeModel

        if (pipe.Forward != null) {
            let forwardData = null;
            if (Array.isArray(pipe.Forward)) {
                pipe.Forward.forEach(function (item, index) {
                    forwardData = {
                        sourcePipe: name,
                        targetPipe: item[&apos;@path&apos;],
                        name: item[&apos;@name&apos;]
                    };
                    forwards.push(forwardData);
                });
            } else {
                forwardData = {
                    sourcePipe: name,
                    targetPipe: pipe.Forward[&apos;@path&apos;],
                    name: pipe.Forward[&apos;@name&apos;]
                };
                forwards.push(forwardData);
            }
        }

        return forwards;
    }

    checkPossitions(xpos, ypos) {
        if (xpos == null &amp;&amp; ypos != null) {
            xpos = ypos;
        } else if (ypos == null &amp;&amp; xpos != null) {
            ypos = xpos;
        }
        if (xpos != null &amp;&amp; ypos != null) {
            return {
                x: xpos,
                y: ypos
            }
        } else {
            return null;
        }
    }
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
