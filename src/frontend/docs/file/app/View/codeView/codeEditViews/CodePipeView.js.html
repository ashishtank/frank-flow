<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../../">
  <title data-ice="title">app/View/codeView/codeEditViews/CodePipeView.js | Frank!Flow</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="dev tool to work with the Frank framework"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Frank!Flow"><meta property="twitter:description" content="dev tool to work with the Frank framework"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#controller">Controller</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Controller/CodeController.js~CodeController.html">CodeController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Controller/FlowController.js~FlowController.html">FlowController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Controller/PipeInfoController.js~PipeInfoController.html">PipeInfoController</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#converter">Converter</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Converter/ConfigurationConverter.js~ConfigurationConverter.html">ConfigurationConverter</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#facade">Facade</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Facade/CodeFacade.js~CodeFacade.html">CodeFacade</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#model">Model</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Model/FileModel.js~FileModel.html">FileModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Model/FlowModel.js~FlowModel.html">FlowModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Model/IbisdocModel.js~IbisdocModel.html">IbisdocModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Model/PipeModel.js~PipeModel.html">PipeModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Model/XsdModel.js~XsdModel.html">XsdModel</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-codeview">View/codeView</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/CodeView.js~CodeView.html">CodeView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/FileTreeView.js~FileTreeView.html">FileTreeView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/ToBeautifulSyntax.js~ToBeautifulSyntax.html">ToBeautifulSyntax</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/ValidateConfigurationView.js~ValidateConfigurationView.html">ValidateConfigurationView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-logColor">logColor</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-codeview-codecompletion">View/codeView/codeCompletion</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeCompletion/XSDCodeCompletionView.js~XSDCodeCompletionView.html">XSDCodeCompletionView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-codeview-codeeditviews">View/codeView/codeEditViews</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/CodeAttributesView.js~CodeAttributesView.html">CodeAttributesView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/CodeEditView.js~CodeEditView.html">CodeEditView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/CodeParametersView.js~CodeParametersView.html">CodeParametersView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/CodePipeView.js~CodePipeView.html">CodePipeView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/CodeTypesView.js~CodeTypesView.html">CodeTypesView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/ExitPipeView.js~ExitPipeView.html">ExitPipeView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/OptionView.js~OptionView.html">OptionView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-flowview">View/flowView</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/DescriptionView.js~DescriptionView.html">DescriptionView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/FlowView.js~FlowView.html">FlowView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/TypeImageView.js~TypeImageView.html">TypeImageView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-flowview-flowgeneration">View/flowView/flowGeneration</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/flowGeneration/CustomElementGenerator.js~CustomElementGenerator.html">CustomElementGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/flowGeneration/FlowGenerator.js~FlowGenerator.html">FlowGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/flowGeneration/ForwardGenerator.js~ForwardGenerator.html">ForwardGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/flowGeneration/PipeGenerator.js~PipeGenerator.html">PipeGenerator</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-flowview-pipe">View/flowView/pipe</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/pipe/ActivityPipeView.js~ActivityPipeView.html">ActivityPipeView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/pipe/PipeBuilder.js~PipeBuilder.html">PipeBuilder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/pipe/PipeView.js~PipeView.html">PipeView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-paletteview">View/paletteView</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/paletteView/PaletteView.js~PaletteView.html">PaletteView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-pipeinfoview">View/pipeInfoView</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/pipeInfoView/PipeInfoView.js~PipeInfoView.html">PipeInfoView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-pipeinfoview-specialpipes">View/pipeInfoView/SpecialPipes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/pipeInfoView/SpecialPipes/XsltInfoView.js~XsltInfoView.html">XsltInfoView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-pipeinfoview-attributes">View/pipeInfoView/attributes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/pipeInfoView/attributes/GenerateInfoAttributesView.js~GenerateInfoAttributesView.html">GenerateInfoAttributesView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-pipeinfoview-parameters">View/pipeInfoView/parameters</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/pipeInfoView/parameters/GenerateInfoParametersView.js~GenerateInfoParametersView.html">GenerateInfoParametersView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#services">services</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/FileService.js~FileService.html">FileService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/IbisdocService.js~IbisdocService.html">IbisdocService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/PipeService.js~PipeService.html">PipeService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/XsdService.js~XsdService.html">XsdService</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">app/View/codeView/codeEditViews/CodePipeView.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import CodeEditView from &apos;./CodeEditView.js&apos;;

export default class CodePipeView extends CodeEditView {

  constructor(editor) {
    super(editor);
  }
  //change the name.
  changeName(oldWord, newWord) {
    let changed = this.changeNameCode(&apos;&lt;[\\S]*?[^&quot;/][pP]ipe(\\n\\t*)?\\s?name=&quot;\\w*&quot;&apos;, oldWord, newWord);
    if (changed) {
      this.changeNameCode(&apos;&lt;forward(\\n\\t*)?(\\s\\w*=&quot;(\\s?\\S)*&quot;(\\n\\t*)?)*\\/&gt;&apos;, oldWord, newWord);
    }
  }

  //change the name of an pipe or forward
  changeNameCode(reg, oldWord, newWord) {
    let cur = this;
    let editor = this.editor;
    let changed = false;
    let attributeObjectRegex = reg;
    let matches = editor.getModel().findMatches(attributeObjectRegex, false, true, false, false);
    matches.forEach(function(item, index) {
      let pipe = editor.getModel().getValueInRange(item.range);
      if (pipe.split(&apos;&quot;&apos;).find(word =&gt; word === oldWord)) {
        let newPipe = pipe.replace(new RegExp(oldWord, &apos;g&apos;), newWord);
        changed = true;
        cur.edit(item.range, newPipe);
      }
    });
    return changed;
  }

  //select a pipe.
  selectPipe(name) {
    let cur = this,
      attributeObjectRegex = &apos;&lt;[\\S]*?[^&quot;/][pP]ipe[\\s\\t\\n][^]*?&gt;[^]*?&lt;[/][\\S]*?[^&quot;/]Pipe&gt;&apos;,
      selectPipe = null,
      matches = this.editor.getModel().findMatches(attributeObjectRegex, false, true, false, false);

    matches.forEach(function(item, index) {
      let pipe = cur.editor.getModel().getValueInRange(item.range);
      if (pipe.match(&apos;name=&quot;&apos; + name + &apos;&quot;&apos;, &apos;g&apos;) !== null) {
        selectPipe = item.range;
      }
    });
    if (selectPipe == null) {
      return selectPipe;
    }
    this.decorations = this.editor.deltaDecorations([], [{
      range: selectPipe,
      options: {
        inlineClassName: &apos;highlightColor&apos;
      }
    }]);
  }

  //change the class type of a pipe
  changePipeType(name, type, oldType) {
    let cur = this,
      attributeObjectRegex = &apos;&lt;[\\S]*?[^&quot;/][pP]ipe[\\s\\t\\n][^]*?&gt;[^]*?&lt;[/][\\S]*?[^&quot;/]Pipe&gt;&apos;,
      selectPipe = null,
      matches = this.editor.getModel().findMatches(attributeObjectRegex, false, true, false, false);
    
      console.log(name, type, oldType)

    matches.forEach(function(item, index) {
      let pipe = cur.editor.getModel().getValueInRange(item.range);
      if (pipe.match(&apos;&lt;&apos; + oldType + &apos;[^]*? name=&quot;&apos; + name + &apos;&quot;&apos;) !== null) {
        pipe = pipe.replace(new RegExp(oldType, &apos;g&apos;), type);
        cur.edit(item.range, pipe);
      }
    })
  }

  //change possition for pipes
  changePossition(name, newX, newY) {
    let cur = this;
    let attributeObjectRegex = &apos;&lt;[\\S]*?[^&quot;/][pP]ipe[\\s\\t\\n][^]*?&gt;|Receiver[\\s\\t\\n][^]*?&gt;&apos;;
    let matches = this.editor.getModel().findMatches(attributeObjectRegex, false, true, false, false);
    name = name.replace(&apos;(receiver): &apos;, &apos;&apos;);
    matches.forEach(function(item, index) {
      let pipe = cur.editor.getModel().getValueInRange(item.range);
      if (pipe.match(&apos;name=&quot;&apos; + name + &apos;&quot;&apos;)) {
        let newPipe = &quot;&quot;;
        if (pipe.split(/[\s=]/).find(word =&gt; word == &apos;x&apos;)) {
          pipe = pipe.replace(new RegExp(&apos;x=&quot;[0-9]*&quot;&apos;, &apos;g&apos;), &apos;x=&quot;&apos; + newX + &apos;&quot;&apos;);
          pipe = pipe.replace(new RegExp(&apos;y=&quot;[0-9]*&quot;&apos;, &apos;g&apos;), &apos;y=&quot;&apos; + newY + &apos;&quot;&apos;);
        } else {
          let str = &apos; x=&quot;&apos; + newX + &apos;&quot; y=&quot;&apos; + newY + &apos;&quot;&apos;;
          if (pipe.indexOf(&apos;/&gt;&apos;) != -1) {
            pipe = pipe.slice(0, pipe.indexOf(&apos;/&apos;)) + str + pipe.slice(pipe.indexOf(&apos;/&apos;));
          } else {
            pipe = pipe.slice(0, pipe.indexOf(&apos;&gt;&apos;)) + str + pipe.slice(pipe.indexOf(&apos;&gt;&apos;));
          }
        }
        cur.edit(item.range, pipe);
      }
    });
  }

  //add a forward
  changeAddForward(name, path) {
    let cur = this;
    let attributeObjectRegex = &apos;&lt;[\\S]*?[^&quot;/][pP]ipe[\\s\\t\\n][^]*?&gt;[^]*?&lt;[/][\\S]*?[^&quot;/]Pipe&gt;&apos;;
    let matches = this.editor.getModel().findMatches(attributeObjectRegex, false, true, false, false);
    matches.forEach(function(item, index) {
      let pipe = cur.editor.getModel().getValueInRange(item.range);
      if (pipe.split(/[\s&gt;]/).find(word =&gt; word === &apos;name=&quot;&apos; + name + &apos;&quot;&apos;)) {
        pipe = pipe.slice(0, pipe.search(/&lt;[/][\S]*?[^&quot;/]Pipe/)) + &apos;\t&lt;Forward name=&quot;success&quot; path=&quot;&apos; + path + &apos;&quot;/&gt;&apos;;
        let newLineRange = {
          endColumn: 1,
          endLineNumber: item.range.endLineNumber,
          startColumn: 1,
          startLineNumber: item.range.endLineNumber
        }
        cur.edit(newLineRange, &apos;\n&apos;);
        cur.edit(item.range, pipe);
      }
    });
  }

  //delete a forward to an pipe.
  deleteForward(name, path) {
    let cur = this;
    let attributeObjectRegex = &apos;&lt;[\\S]*?[^&quot;/][pP]ipe[\\s\\t\\n][^]*?&gt;[^]*?&lt;[/][\\S]*?[^&quot;/]Pipe&gt;&apos;;
    let matches = this.editor.getModel().findMatches(attributeObjectRegex, false, true, false, false);
    matches.forEach(function(item, index) {
      let pipe = cur.editor.getModel().getValueInRange(item.range);
      if (pipe.split(/[\s&gt;]/).find(word =&gt; word === &apos;name=&quot;&apos; + name + &apos;&quot;&apos;)) {
        path.toLowerCase() == &quot;exit&quot; ? path = &quot;Exit&quot; : path = path;
        let newPipe = pipe.replace(new RegExp(&apos;&lt;Forward[^/]*?path=&quot;&apos; + path + &apos;&quot;[^]*?/&gt;&apos;, &apos;gi&apos;), &quot;&quot;);
        cur.edit(item.range, newPipe);
      }
    });
  }

  // a method to add a pipe by hand.
  changeAddPipe(name, possitions, className = &quot;customPipe&quot;) {
    let cur = this;
    let adapterName = $(&apos;#canvas&apos;).text().match(/Adapter:\s.*?\s/g)[0].replace(/Adapter:\s/g, &apos;&apos;).replace(&apos; &apos;, &apos;&apos;);
    let attributeObjectRegex = &apos;&lt;Adapter name=&quot;&apos; + localStorage.getItem(&quot;currentAdapter&quot;) + &apos;&quot;[\\s\\S\\n]*?&lt;Exit&apos;;
    let matchString = this.editor.getModel().getValue().match(attributeObjectRegex);

    //&apos;&lt;Exit&apos;;
    let matches = this.editor.getModel().findMatches(attributeObjectRegex, false, true, false, false);
    matches.some(function(item, index) {
      let range = item.range;
      range.startColumn = 1;
      range.endColumn = 1;
      range.startLineNumber = range.endLineNumber
      cur.edit(range, &apos;\n&apos;);

      let newPipe = &apos;\t\t\t&lt;&apos; + className + &apos; name=&quot;&apos; + name + &apos;&quot; x=&quot;&apos; + possitions.x + &apos;&quot; y=&quot;&apos; + possitions.y + &apos;&quot;&gt;\n\n\t\t\t&lt;/&apos; + className + &apos;&gt;\n&apos;;
      cur.edit(range, newPipe);
      return true;
    });
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
