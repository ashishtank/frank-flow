<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">app/Converter/ConfigurationConverter.js | Frank!Flow</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="dev tool to work with the Frank framework"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Frank!Flow"><meta property="twitter:description" content="dev tool to work with the Frank framework"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#controller">Controller</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Controller/CodeController.js~CodeController.html">CodeController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Controller/FlowController.js~FlowController.html">FlowController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Controller/PipeInfoController.js~PipeInfoController.html">PipeInfoController</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#converter">Converter</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Converter/ConfigurationConverter.js~ConfigurationConverter.html">ConfigurationConverter</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#facade">Facade</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Facade/CodeFacade.js~CodeFacade.html">CodeFacade</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#model">Model</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Model/FileModel.js~FileModel.html">FileModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Model/FlowModel.js~FlowModel.html">FlowModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Model/IbisdocModel.js~IbisdocModel.html">IbisdocModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Model/PipeModel.js~PipeModel.html">PipeModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Model/XsdModel.js~XsdModel.html">XsdModel</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-codeview">View/codeView</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/CodeView.js~CodeView.html">CodeView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/FileTreeView.js~FileTreeView.html">FileTreeView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/ToBeautifulSyntax.js~ToBeautifulSyntax.html">ToBeautifulSyntax</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/ValidateConfigurationView.js~ValidateConfigurationView.html">ValidateConfigurationView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-logColor">logColor</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-codeview-codecompletion">View/codeView/codeCompletion</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeCompletion/XSDCodeCompletionView.js~XSDCodeCompletionView.html">XSDCodeCompletionView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-codeview-codeeditviews">View/codeView/codeEditViews</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/CodeAttributesView.js~CodeAttributesView.html">CodeAttributesView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/CodeEditView.js~CodeEditView.html">CodeEditView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/CodeParametersView.js~CodeParametersView.html">CodeParametersView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/CodePipeView.js~CodePipeView.html">CodePipeView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/CodeTypesView.js~CodeTypesView.html">CodeTypesView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/ExitPipeView.js~ExitPipeView.html">ExitPipeView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/codeView/codeEditViews/OptionView.js~OptionView.html">OptionView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-flowview">View/flowView</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/DescriptionView.js~DescriptionView.html">DescriptionView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/FlowView.js~FlowView.html">FlowView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/TypeImageView.js~TypeImageView.html">TypeImageView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-flowview-flowgeneration">View/flowView/flowGeneration</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/flowGeneration/CustomElementGenerator.js~CustomElementGenerator.html">CustomElementGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/flowGeneration/FlowGenerator.js~FlowGenerator.html">FlowGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/flowGeneration/ForwardGenerator.js~ForwardGenerator.html">ForwardGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/flowGeneration/PipeGenerator.js~PipeGenerator.html">PipeGenerator</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-flowview-pipe">View/flowView/pipe</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/pipe/ActivityPipeView.js~ActivityPipeView.html">ActivityPipeView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/pipe/PipeBuilder.js~PipeBuilder.html">PipeBuilder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/flowView/pipe/PipeView.js~PipeView.html">PipeView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-paletteview">View/paletteView</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/paletteView/PaletteView.js~PaletteView.html">PaletteView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-pipeinfoview">View/pipeInfoView</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/pipeInfoView/PipeInfoView.js~PipeInfoView.html">PipeInfoView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-pipeinfoview-specialpipes">View/pipeInfoView/SpecialPipes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/pipeInfoView/SpecialPipes/XsltInfoView.js~XsltInfoView.html">XsltInfoView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-pipeinfoview-attributes">View/pipeInfoView/attributes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/pipeInfoView/attributes/GenerateInfoAttributesView.js~GenerateInfoAttributesView.html">GenerateInfoAttributesView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#view-pipeinfoview-parameters">View/pipeInfoView/parameters</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/View/pipeInfoView/parameters/GenerateInfoParametersView.js~GenerateInfoParametersView.html">GenerateInfoParametersView</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#services">services</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/FileService.js~FileService.html">FileService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/IbisdocService.js~IbisdocService.html">IbisdocService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/PipeService.js~PipeService.html">PipeService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/services/XsdService.js~XsdService.html">XsdService</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">app/Converter/ConfigurationConverter.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">export default class ConfigurationConverter {

  // a function that converts the xml to a readable json format and then generates a flow
  convertConfiguration(editor) {
    let value = editor.getValue();

    //replace all pipe classes with &apos;pipe&apos; so all pipes can become an array of pipes.
    value = value.replace(/&lt;[^\/][\S]*?[^&quot;\/]Pipe/g, &quot;&lt;pipe&quot;);
    value = value.replace(/&lt;[\/][\S]*?[^&quot;\/]Pipe/g, &quot;&lt;/pipe&quot;).replace(/&amp;/g, &apos;&apos;);
    value = value.replace(/&lt;!--[^]*?--&gt;/g, &apos;&apos;)
    var getXml = new DOMParser();

    let xml = getXml.parseFromString(value, &quot;text/xml&quot;);


    //check for parse error. if(childnodes &gt; 1) it is a parse error.
    if(xml.childNodes.length &gt; 1) {
      return xml.lastElementChild.firstChild.textContent;
    }
    let transformedXml = JSON.parse(this.xml2json(xml).replace(&apos;undefined&apos;, &apos;&apos;));

    if(transformedXml.Configuration == null &amp;&amp; transformedXml.Module != null) {
      let module = transformedXml.Module;
      transformedXml = {};
      transformedXml.Configuration = module;
    }

    if (transformedXml.Configuration.Module == null &amp;&amp; transformedXml.Configuration.Adapter != null) {
      transformedXml.Adapter = transformedXml.Configuration.Adapter;
    } else {
	      if(Array.isArray(transformedXml.Configuration.Module)) {
	      transformedXml.Configuration.Module.forEach(function(item, index) {
	        if (Array.isArray(item.Adapter)) {
	          item.Adapter.forEach(function(item, index) {
	            if (item[&quot;@name&quot;] != null &amp;&amp; item[&quot;@name&quot;] == localStorage.getItem(&quot;currentAdapter&quot;)) {
	              transformedXml.Adapter = item;
	            }
	          })
	        } else {
	          if (item.Adapter != null &amp;&amp; item.Adapter[&quot;@name&quot;] != null &amp;&amp; item.Adapter[&quot;@name&quot;] == localStorage.getItem(&quot;currentAdapter&quot;)) {
	            transformedXml = item;
	          }
	        }
	      });
	    } else {
	    	transformedXml.Adapter = transformedXml.Configuration.Module.Adapter;
	    }
    }
    return transformedXml;
  }

  domParse(xml) {
    var getXml = new DOMParser();
    let domXml = getXml.parseFromString(xml, &quot;text/xml&quot;);
    return domXml;
  }

  /*	This work is licensed under Creative Commons GNU LGPL License.

  License: http://creativecommons.org/licenses/LGPL/2.1/
   Version: 0.9
  Author:  Stefan Goessner/2006
  Web:     http://goessner.net/
  */
  xml2json(xml, tab) {
    var X = {
      toObj: function(xml) {
        var o = {};
        if (xml.nodeType == 1) { // element node ..
          if (xml.attributes.length) // element with attributes  ..
            for (var i = 0; i &lt; xml.attributes.length; i++)
              o[&quot;@&quot; + xml.attributes[i].nodeName] = (xml.attributes[i].nodeValue || &quot;&quot;).toString();
          if (xml.firstChild) { // element has child nodes ..
            var textChild = 0,
              cdataChild = 0,
              hasElementChild = false;
            for (var n = xml.firstChild; n; n = n.nextSibling) {
              if (n.nodeType == 1) hasElementChild = true;
              else if (n.nodeType == 3 &amp;&amp; n.nodeValue.match(/[^ \f\n\r\t\v]/)) textChild++; // non-whitespace text
              else if (n.nodeType == 4) cdataChild++; // cdata section node
            }
            if (hasElementChild) {
              if (textChild &lt; 2 &amp;&amp; cdataChild &lt; 2) { // structured element with evtl. a single text or/and cdata node ..
                X.removeWhite(xml);
                for (var n = xml.firstChild; n; n = n.nextSibling) {
                  if (n.nodeType == 3) // text node
                    o[&quot;#text&quot;] = X.escape(n.nodeValue);
                  else if (n.nodeType == 4) // cdata node
                    o[&quot;#cdata&quot;] = X.escape(n.nodeValue);
                  else if (o[n.nodeName]) { // multiple occurence of element ..
                    if (o[n.nodeName] instanceof Array)
                      o[n.nodeName][o[n.nodeName].length] = X.toObj(n);
                    else
                      o[n.nodeName] = [o[n.nodeName], X.toObj(n)];
                  } else // first occurence of element..
                    o[n.nodeName] = X.toObj(n);
                }
              } else { // mixed content
                if (!xml.attributes.length)
                  o = X.escape(X.innerXml(xml));
                else
                  o[&quot;#text&quot;] = X.escape(X.innerXml(xml));
              }
            } else if (textChild) { // pure text
              if (!xml.attributes.length)
                o = X.escape(X.innerXml(xml));
              else
                o[&quot;#text&quot;] = X.escape(X.innerXml(xml));
            } else if (cdataChild) { // cdata
              if (cdataChild &gt; 1)
                o = X.escape(X.innerXml(xml));
              else
                for (var n = xml.firstChild; n; n = n.nextSibling)
                  o[&quot;#cdata&quot;] = X.escape(n.nodeValue);
            }
          }
          if (!xml.attributes.length &amp;&amp; !xml.firstChild) o = null;
        } else if (xml.nodeType == 9) { // document.node
          o = X.toObj(xml.documentElement);
        }
        return o;
      },
      toJson: function(o, name, ind) {
        var json = name ? (&quot;\&quot;&quot; + name + &quot;\&quot;&quot;) : &quot;&quot;;
        if (o instanceof Array) {
          for (var i = 0, n = o.length; i &lt; n; i++)
            o[i] = X.toJson(o[i], &quot;&quot;, ind + &quot;\t&quot;);
          json += (name ? &quot;:[&quot; : &quot;[&quot;) + (o.length &gt; 1 ? (&quot;\n&quot; + ind + &quot;\t&quot; + o.join(&quot;,\n&quot; + ind + &quot;\t&quot;) + &quot;\n&quot; + ind) : o.join(&quot;&quot;)) + &quot;]&quot;;
        } else if (o == null)
          json += (name &amp;&amp; &quot;:&quot;) + &quot;null&quot;;
        else if (typeof(o) == &quot;object&quot;) {
          var arr = [];
          for (var m in o)
            arr[arr.length] = X.toJson(o[m], m, ind + &quot;\t&quot;);
          json += (name ? &quot;:{&quot; : &quot;{&quot;) + (arr.length &gt; 1 ? (&quot;\n&quot; + ind + &quot;\t&quot; + arr.join(&quot;,\n&quot; + ind + &quot;\t&quot;) + &quot;\n&quot; + ind) : arr.join(&quot;&quot;)) + &quot;}&quot;;
        } else if (typeof(o) == &quot;string&quot;)
          json += (name &amp;&amp; &quot;:&quot;) + &quot;\&quot;&quot; + o.toString() + &quot;\&quot;&quot;;
        else
          json += (name &amp;&amp; &quot;:&quot;) + o.toString();
        return json;
      },
      innerXml: function(node) {
        var s = &quot;&quot;
        if (&quot;innerHTML&quot; in node)
          s = node.innerHTML;
        else {
          var asXml = function(n) {
            var s = &quot;&quot;;
            if (n.nodeType == 1) {
              s += &quot;&lt;&quot; + n.nodeName;
              for (var i = 0; i &lt; n.attributes.length; i++)
                s += &quot; &quot; + n.attributes[i].nodeName + &quot;=\&quot;&quot; + (n.attributes[i].nodeValue || &quot;&quot;).toString() + &quot;\&quot;&quot;;
              if (n.firstChild) {
                s += &quot;&gt;&quot;;
                for (var c = n.firstChild; c; c = c.nextSibling)
                  s += asXml(c);
                s += &quot;&lt;/&quot; + n.nodeName + &quot;&gt;&quot;;
              } else
                s += &quot;/&gt;&quot;;
            } else if (n.nodeType == 3)
              s += n.nodeValue;
            else if (n.nodeType == 4)
              s += &quot;&lt;![CDATA[&quot; + n.nodeValue + &quot;]]&gt;&quot;;
            return s;
          };
          for (var c = node.firstChild; c; c = c.nextSibling)
            s += asXml(c);
        }
        return s;
      },
      escape: function(txt) {
        return txt.replace(/[\\]/g, &quot;\\\\&quot;)
          .replace(/[\&quot;]/g, &apos;\\&quot;&apos;)
          .replace(/[\n]/g, &apos;\\n&apos;)
          .replace(/[\r]/g, &apos;\\r&apos;);
      },
      removeWhite: function(e) {
        e.normalize();
        for (var n = e.firstChild; n;) {
          if (n.nodeType == 3) { // text node
            if (!n.nodeValue.match(/[^ \f\n\r\t\v]/)) { // pure whitespace text node
              var nxt = n.nextSibling;
              e.removeChild(n);
              n = nxt;
            } else
              n = n.nextSibling;
          } else if (n.nodeType == 1) { // element node
            X.removeWhite(n);
            n = n.nextSibling;
          } else // any other node
            n = n.nextSibling;
        }
        return e;
      }
    };
    if (xml.nodeType == 9) // document node
      xml = xml.documentElement;
    var json = X.toJson(X.toObj(X.removeWhite(xml)), xml.nodeName, &quot;\t&quot;);
    return &quot;{\n&quot; + tab + (tab ? json.replace(/\t/g, tab) : json.replace(/\t|\n/g, &quot;&quot;)) + &quot;\n}&quot;;
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
